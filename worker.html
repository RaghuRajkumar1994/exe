<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Production Submission</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; background-color: #f4f4f9; }
        h1 { color: #333; text-align: center; border-bottom: 2px solid #ccc; padding-bottom: 10px;}
        label { display: block; margin-top: 10px; font-weight: bold; color: #555; }
        input, select { width: 100%; padding: 10px; margin-bottom: 15px; box-sizing: border-box; border-radius: 6px; border: 1px solid #ccc; font-size: 16px; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn-group button { flex: 1; padding: 12px; font-weight: bold; border: none; border-radius: 6px; cursor: pointer; }
        #submit-button { background-color: #4CAF50; color: white; }
        #submit-button:hover { background-color: #45a049; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);}
        #reset-button { background-color: #f44336; color: white; }
        #reset-button:hover { background-color: #d32f2f; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);}
        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .input-row.three-col > div { flex: 1; } 
        .message { text-align: center; color: green; font-weight: bold; margin-top: 20px; background-color: #e6ffe6; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Production Data Entry</h1>

    <div class="input-row">
        <div>
            <label for="entry-date">Production Date (System Time):</label>
            <input type="date" id="entry-date" required>
        </div>
        <div>
            <label for="entry-time">Production Time (System Time):</label>
            <input type="time" id="entry-time" required>
        </div>
    </div>
    
    <label for="shift">Shift:</label>
    <select id="shift" required>
        <option value="" disabled selected>Select Shift</option>
        <option value="A">Shift A</option>
        <option value="B">Shift B</option>
        <option value="C">Shift C</option>
    </select>

    <label for="worker-name">Worker Name:</label>
    <input type="text" id="worker-name" placeholder="Enter your name" required>

    <label for="machine-name">Machine Name:</label>
    <input type="text" id="machine-name" placeholder="e.g., W_CUT_01" required>

    <div class="input-row">
        <div>
            <label for="order-no">Order No:</label>
            <input type="text" id="order-no" placeholder="e.g., C00123" required>
        </div>
        <div>
            <label for="fg-part-no">FG Part No:</label>
            <input type="text" id="fg-part-no" placeholder="e.g., P-789" required>
        </div>
    </div>
    
    <label for="cable-id">Cable Identification:</label>
    <input type="text" id="cable-id" placeholder="e.g., 1.5mm Blue" required>

    <label for="applicator-no">Applicator No:</label>
    <input type="text" id="applicator-no" placeholder="e.g., APL-05" required>

    <div class="input-row three-col">
        <div>
            <label for="produced-qty">Produced Qty:</label>
            <input type="number" id="produced-qty" placeholder="Units Produced" required min="1">
        </div>
        <div>
            <label for="produced-length">Length (M/F):</label>
            <input type="number" step="0.1" id="produced-length" placeholder="e.g., 50.5" required min="0.1">
        </div>
        <div>
            <label for="worked-hours">Worked Hours (Dec):</label>
            <input type="number" step="0.1" id="worked-hours" placeholder="e.g., 4.5" required min="0.1">
        </div>
    </div>
    
    <div class="btn-group">
        <button id="submit-button" onclick="submitOutput()">Submit Production Data</button>
        <button id="reset-button" onclick="resetForm()">Reset All Fields</button>
    </div>

    <div id="message" class="message"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        const socket = io();

        // Utility to set current date/time
        function setInitialDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            document.getElementById('entry-date').value = `${year}-${month}-${day}`;
            document.getElementById('entry-time').value = `${hours}:${minutes}`;
        }
        
        document.addEventListener('DOMContentLoaded', setInitialDateTime);

        // Function to reset ALL fields
        function resetForm() {
            document.getElementById('worker-name').value = '';
            document.getElementById('machine-name').value = '';
            document.getElementById('order-no').value = '';
            document.getElementById('fg-part-no').value = '';
            document.getElementById('applicator-no').value = '';
            document.getElementById('cable-id').value = '';
            document.getElementById('produced-qty').value = '';
            document.getElementById('produced-length').value = '';
            document.getElementById('worked-hours').value = ''; 
            document.getElementById('shift').value = '';
            
            setInitialDateTime();

            document.getElementById('message').textContent = 'All fields have been reset.';
            document.getElementById('message').style.backgroundColor = '#ffccee';
            setTimeout(() => { document.getElementById('message').textContent = ''; }, 3000); 
        }
        
        function submitOutput() {
            // Re-capture system time right before submission for accuracy
            setInitialDateTime();

            const data = {
                entryDate: document.getElementById('entry-date').value.trim(),
                entryTime: document.getElementById('entry-time').value.trim(),
                shift: document.getElementById('shift').value.trim(),
                workerName: document.getElementById('worker-name').value.trim(),
                machineName: document.getElementById('machine-name').value.trim(),
                orderNo: document.getElementById('order-no').value.trim(),
                fgPartNo: document.getElementById('fg-part-no').value.trim(),
                applicatorNo: document.getElementById('applicator-no').value.trim(),
                cableId: document.getElementById('cable-id').value.trim(),
                producedQty: document.getElementById('produced-qty').value.trim(),
                producedLength: document.getElementById('produced-length').value.trim(),
                workedHours: document.getElementById('worked-hours').value.trim()
            };

            // Basic validation check
            for (const key in data) {
                if (!data[key]) {
                    document.getElementById('message').textContent = 'Please fill out all required fields.';
                    document.getElementById('message').style.backgroundColor = '#ffcccc';
                    return;
                }
            }
            if (parseInt(data.producedQty) <= 0 || parseFloat(data.producedLength) <= 0 || parseFloat(data.workedHours) <= 0) {
                 document.getElementById('message').textContent = 'Quantity, Length, and Hours must be greater than zero.';
                 document.getElementById('message').style.backgroundColor = '#ffcccc';
                 return;
            }
            
            document.getElementById('message').style.backgroundColor = '#e6ffe6';

            // Send the detailed data to the server
            socket.emit('submit_output', data);

            // DATA RETENTION: ONLY CLEAR QTY, LENGTH, AND HOURS
            document.getElementById('produced-qty').value = '';
            document.getElementById('produced-length').value = '';
            document.getElementById('worked-hours').value = '';
            
            document.getElementById('message').textContent = 'Output submitted successfully! Ready for next entry.';
            setTimeout(() => { document.getElementById('message').textContent = ''; }, 3000); 
        }
    </script>
</body>
</html>